# Реализованные инструменты для банковского бота

## Обзор

В проект добавлены 4 новых инструмента для расширения функциональности банковского бота:

1. **calculate_loan** - Калькулятор кредита
2. **calculate_deposit** - Калькулятор вклада
3. **convert_currency** - Конвертер валют
4. **calculate_early_repayment** - Расчет досрочного погашения

## Установка

Инструменты уже добавлены в `src/tools.py` и подключены к агенту в `src/agent.py`. 
Системный промпт обновлен в `prompts/agent_system.txt`.

Никаких дополнительных зависимостей не требуется - используются только стандартные библиотеки Python.

## Использование

Агент автоматически выбирает нужный инструмент на основе вопроса пользователя.

### Примеры запросов:

**Калькулятор кредита:**
- "Рассчитай платеж по кредиту 500000 рублей на 5 лет под 12% годовых"
- "Сколько будет ежемесячный платеж при кредите 1 млн на 3 года под 15%?"
- "Посчитай переплату по кредиту 300000 на 2 года под 10%"

**Калькулятор вклада:**
- "Сколько я получу, если положу 100000 рублей на год под 8% с капитализацией?"
- "Рассчитай доходность вклада 500000 на 6 месяцев под 7% без капитализации"

**Конвертер валют:**
- "Сколько будет 1000 долларов в рублях?"
- "Конвертируй 50000 рублей в евро"
- "100 евро это сколько рублей?"

**Досрочное погашение:**
- "Сколько я сэкономлю, если погашу досрочно 100000 рублей?"
- "Рассчитай новый платеж после досрочного погашения 50000"

## Технические детали

### calculate_loan
- Поддерживает аннуитетные и дифференцированные платежи
- Рассчитывает ежемесячный платеж, общую сумму, переплату
- Возвращает график платежей на первые 6 месяцев

### calculate_deposit
- Учитывает капитализацию процентов (сложный процент)
- Рассчитывает финальную сумму, начисленные проценты
- Показывает эффективную ставку

### convert_currency
- Поддерживает: RUB, USD, EUR, GBP, CNY, JPY
- Использует мок-курсы (для продакшена нужен реальный API)
- Конвертация через рубли

### calculate_early_repayment
- Рассчитывает новый баланс и платеж после досрочного погашения
- Показывает экономию на процентах
- Может рассчитать новый срок или новый платеж

## Примечания

1. **Курсы валют** - в текущей реализации используются фиксированные мок-курсы. 
   Для продакшена нужно интегрировать реальный API курсов валют (например, API ЦБ РФ или Сбербанка).

2. **Точность расчетов** - все расчеты выполняются с точностью до 2 знаков после запятой.

3. **Валидация** - инструменты проверяют входные данные и возвращают ошибки в понятном формате.

4. **Логирование** - все ошибки логируются для отладки.

## Расширение функциональности

Для добавления новых инструментов:

1. Создайте функцию в `src/tools.py` с декоратором `@tool`
2. Добавьте импорт в `src/agent.py`
3. Добавьте инструмент в список `tools` в функции `create_bank_agent()`
4. Обновите системный промпт в `prompts/agent_system.txt`

Примеры других полезных инструментов см. в `docs/tools-proposals.md`.

